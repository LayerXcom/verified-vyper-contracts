import pytest
from web3 import Web3

N = [80946312435742893162269182027286168982458258986392013602913524631232064034484,
    67809251382290146368857461934422217270315634662502738506896957186896411395852,
    32432476295143674333647052353281846215904064919090353517923267849072571109732,
    97985650512097174582438390172123096127310964532713997866929284351410268860683,
    13154304360276038533660786005217728908375598918815057353003252289874621170548,
    60855634196609600593208184699147768610531128140436496744405829196935973449422,
    2514693881447445838798831742432506661944046185460035613540755019117283127655,
    79405065668804699346261014168718981824460403581712392556422464031573372741133]

N_HEX = 0xb2f5fd3f9f0917112ce42f8bf87ed676e15258be443f36deafb0b69bde2496b495eaad1b01cad84271b014e96f79386c636d348516da74a68a8c70fba882870c47b4218d8f49186ddf72727b9d80c21911c3e337c6e407ffb47c2f2767b0d164d8a1e9af95f6481bf8d9edfb2e3904b2529268c460256fafd0a677d29898f10b1d15128a695839fc08edd584e8335615b1d1d7277be65c532dca92ddc7050374868b117ea9154914ef9292b8443f13696e4fad50ded6bd90e5a6f7ed33be2ece31c6dd7a4253ee6cdc56787ddd1d5cd776614022db87d03bb22f23285b5a3167af8dacabbea40004471337d3781e8c5cca0ea5e27799b510e4ef938c61caa60d

G = 3

@pytest.fixture
def c(get_contract):
    with open('../contracts/accumulator/RSAAccumulator.vy') as f:
        code = f.read()
    # eth.exceptions.OutOfGas: Contract code size exceeds EIP170 limit of 24577.
    c = get_contract(code, N)
    return c

def test_init_state(c):
    assert uint256_list_to_int(c.N) == N_HEX
    assert uint256_list_to_int(c.initialAccumulator) == G
    assert uint256_list_to_int(c.accumulator) == G

def uint256_list_to_int(l):
    out = 0
    for i in range(len(l)):
        out += l[i] * 2 ** (32 * i)
    return out

